"use strict";const t={0:"PRTSCR",8:"BACKSPACE",9:"TAB",16:"SHIFT",17:"CTRL",18:"ALT",20:"CAPSLOCK",27:"ESC",32:"SPACE",33:"PGUP",34:"PGDN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",45:"INSERT",46:"DEL",91:"WIN",92:"WIN",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NUMLOCK",145:"SCROLLLOCK",224:"CMD"};class e{constructor(t,e){this.x=t,this.y=e}add(t){return"number"==typeof t?new e(this.x+t,this.y+t):new e(this.x+t.x,this.y+t.y)}_add(t){return this.x+="number"==typeof t?t:t.x,this.y+="number"==typeof t?t:t.y,this}subtract(t){return"number"==typeof t?new e(this.x-t,this.y-t):new e(this.x-t.x,this.y-t.y)}_subtract(t){return this.x-="number"==typeof t?t:t.x,this.y-="number"==typeof t?t:t.y,this}divideBy(t){return new e(this.x/t,this.y/t)}multiplyBy(t){return new e(this.x*t,this.y*t)}}const n=document.getElementById("container"),s=document.getElementById("text-input"),i=document.getElementById("text-canvas"),o=document.getElementById("cursor-canvas"),a=i.getContext("2d",{alpha:!0}),r=o.getContext("2d"),c=(t,e)=>{let{x:n,y:s}=e;t.style.transform="translate(".concat(n,"px, ").concat(s,"px)")},l=parseInt(String(Math.min(26,window.innerWidth/17)),10),d=12*l/20,h=l+8,u=d,p=h-6,m=function(){const t=Math.min(100,window.innerWidth/8),n=Math.min(t,window.innerHeight/8);return new e(t,n)}();s.style.width="".concat(u,"px"),s.style.height="".concat(p,"px");const v=m;class f{constructor(){this.position=v,this.reset=()=>{this.update(v)},this.clear=()=>{const t=this.position.subtract(1).divideBy(1),e=u+4,n=p+4;r.clearRect(t.x,t.y,e,n)},this.update=t=>{c(s,{x:Math.min(t.x,window.innerWidth-u),y:Math.min(t.y,window.innerHeight)}),this.clear(),this.position=t,this.draw()},this._draw=()=>{const t=this.position.divideBy(1);r.fillRect(t.x,t.y,u,p)},this.draw=()=>{this._draw(),window.clearTimeout(this._cursorTimeout),this._raf&&window.cancelAnimationFrame(this._raf),this._opacity=.72,this._cursorTimeout=window.setTimeout(this.fadeOut.bind(this),2200)},this.nudge=t=>{this.update(this.position.add(t.multiplyBy(1)))},this.moveleft=()=>{this.nudge(new e(-u,0))},this.moveright=()=>{this.nudge(new e(u,0))},this.moveup=()=>{this.nudge(new e(0,-p))},this.movedown=()=>{this.nudge(new e(0,p))},this.moveToClick=t=>{this.update(t.subtract(new e(u/2,p/2)))},this.addtab=()=>{this.nudge(new e(4*d,0))},this.newline=()=>{this.update(new e(m.x,this.position.y+h))},this.fadeOut=()=>{this._time=new Date,this._raf=requestAnimationFrame(this._fadeanim.bind(this))},this._fadeanim=()=>{const t=Date.now()-this._time.valueOf(),e=this._opacity-.1*t/300;e<=0?this.clear():(r.save(),this.clear(),this._opacity=e,r.globalAlpha=this._opacity,this._draw(),r.restore(),this._raf=window.requestAnimationFrame(this._fadeanim.bind(this)))},this.navButtons={Backspace:this.moveleft.bind(this),Tab:this.addtab.bind(this),ArrowLeft:this.moveleft.bind(this),ArrowUp:this.moveup.bind(this),ArrowRight:this.moveright.bind(this),ArrowDown:this.movedown.bind(this),Enter:this.newline.bind(this)}}}function w(t,e){const n=t-e,s=t+e;return Math.random()*(s-n)+n}class g extends e{constructor(t,e,n,s){super(w(n,.2),w(s,.2)),this.draw=()=>{const t=this.add(this.typewriter.canvasOffset);a&&(a.save(),a.translate(t.x,t.y),a.rotate(this.rotate),a.globalAlpha=this.alpha,a.fillText(this.s,0,0),a.restore())},this.s=e,this.rotate=w(0,.05),this.alpha=w(.72,.06),this.typewriter=t,this._subtract(t.canvasOffset),this.draw()}}const y=parseInt(String(Math.min(26,window.innerWidth/17)),10);class b{constructor(){if(this.canvasOffset=new e(0,0),this.containerScale=1,this.chars=[],this.cursor=new f,this.addCharacter=(t,n,s)=>{if(void 0!==n&&void 0!==s)return this.chars.push(new g(this,t,n,s)),void this.cursor.update(new e(n,s));for(let e=0,n=t.length;e<n;e+=1){const{position:{x:n,y:s}}=this.cursor,i=t[e];this.chars.push(new g(this,i,n,s)),this.cursor.moveright()}},this.redraw=()=>{this.chars.forEach(t=>t.draw())},this.resetCanvases=()=>{[a,r].forEach(t=>{const{canvas:e}=t,{devicePixelRatio:n=1,innerWidth:s,innerHeight:i}=window;t.setTransform(1,0,0,1,0,0),e.width=s*n,e.height=i*n,e.style.width="".concat(s,"px"),e.style.height="".concat(i,"px"),t.scale(n,n),t.globalAlpha=.72}),a.font="".concat(y,"px Special Elite, serif"),a.textBaseline="top",a.fillStyle="#150904",r.fillStyle="#4787ea",r.scale(this.containerScale,this.containerScale)},this.reposition=t=>{t instanceof e&&this.canvasOffset._add(t),c(n,{x:0,y:0}),this.resetCanvases(),this.redraw()},this.debouncedReposition=function(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];e&&clearTimeout(e),e=window.setTimeout(()=>{t(...i)},n)}}(this.reposition,100),this.reset=()=>{this.chars=[],this.cursor.reset(),this.canvasOffset=new e(0,0),this.containerScale=1,n.setAttribute("style",""),this.reposition(),this.cursor.draw()},b._instance)return b._instance;b._instance=this,window.addEventListener("resize",this.debouncedReposition)}export(){return JSON.stringify(this.chars.map(t=>{let{x:e,y:n,s:s}=t;return{x:e,y:n,s:s}}))}import(t){try{const e=JSON.parse(t);if(!Array.isArray(e))return;this.reset();for(const{s:t,x:n,y:s}of e)this.addCharacter(t,n,s)}catch(t){console.error("failed to import")}}}const C=t=>{if("touches"in t){const n="touchend"===t.type?t.changedTouches[0]:t.touches[0];return new e(n.pageX,n.pageY)}return new e(t.pageX,t.pageY)},k=function(t,e){let n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:350;const i=()=>{window.clearTimeout(n),n=0},o=t=>{1===t.touches.length?n=window.setTimeout(()=>e(t),s):n&&i()};return t.addEventListener("touchstart",o),t.addEventListener("touchmove",i),t.addEventListener("touchend",i),()=>{t.removeEventListener("touchstart",o),t.removeEventListener("touchmove",i),t.removeEventListener("touchend",i)}};function x(t,e){const n=document.createElement(t);for(const t in e){const s=t;n[s]=e[s]}return n}const L=o;class M{constructor(){this.menu=x("div",{className:"popup menu",id:"menu"}),this.menuBackdrop=x("div",{className:"backdrop menu-backdrop",id:"menu-backdrop"}),this.handleContextMenu=t=>{var e;if(this.menu.contains(t.target))return;const{x:n,y:s}=C(t).add(5);t.preventDefault(),this.openMenu({x:n,y:s}),null===(e=window.gtag)||void 0===e||e.call(window,"event","menu:open",{event_category:"menu"})},this.handleClose=t=>{let{target:e}=t;this.menu.contains(e)||this.closeMenu()},this.events("on"),this.menu.setAttribute("role","list"),this.menu.tabIndex=-1,this.menuBackdrop.appendChild(this.menu)}destroy(){var t;this.events("off"),null===(t=this.menuBackdrop.parentNode)||void 0===t||t.removeChild(this.menuBackdrop)}addMenuItem(t){let{callback:e,href:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=x(n?"a":"div",{innerHTML:t,className:"menu-item"});"A"===s.tagName&&(s.target="_blank",s.href=n),e&&(s.addEventListener("click",e),s.addEventListener("keydown",t=>{"Enter"===t.key&&e()})),(e||n)&&(s.classList.add("clickable"),s.tabIndex=0),s.setAttribute("role","listitem"),this.menu.appendChild(s)}addDivider(){const t=x("hr");this.menu.appendChild(t)}events(){const t="on"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"on")?"addEventListener":"removeEventListener",e={contextmenu:this.handleContextMenu};for(const n in e)L[t](n,e[n])}openMenu(t){null==this.menuBackdrop.parentNode&&(document.body.appendChild(this.menuBackdrop),document.body.addEventListener("click",this.handleClose)),c(this.menu,t),s.tabIndex=-1,s.disabled=!0,this.menu.focus()}closeMenu(){const t=this.menuBackdrop;if(s.tabIndex=0,s.disabled=!1,!t||null==t.parentNode)return;document.body.removeEventListener("click",this.handleClose);const e=n=>{var s;n.target===t&&(t.removeEventListener("animationend",e),t.classList.remove("exit"),null===(s=t.parentNode)||void 0===s||s.removeChild(t))};t.addEventListener("animationend",e),t.classList.add("exit")}}var T,E=(function(t){var e=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function i(t,e){if(!s[t]){s[t]={};for(var n=0;n<t.length;n++)s[t][t.charAt(n)]=n}return s[t][e]}var o={compressToBase64:function(t){if(null==t)return"";var n=o._compress(t,6,(function(t){return e.charAt(t)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:o._decompress(t.length,32,(function(n){return i(e,t.charAt(n))}))},compressToUTF16:function(e){return null==e?"":o._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:o._decompress(t.length,16384,(function(e){return t.charCodeAt(e)-32}))},compressToUint8Array:function(t){for(var e=o.compress(t),n=new Uint8Array(2*e.length),s=0,i=e.length;s<i;s++){var a=e.charCodeAt(s);n[2*s]=a>>>8,n[2*s+1]=a%256}return n},decompressFromUint8Array:function(e){if(null==e)return o.decompress(e);for(var n=new Array(e.length/2),s=0,i=n.length;s<i;s++)n[s]=256*e[2*s]+e[2*s+1];var a=[];return n.forEach((function(e){a.push(t(e))})),o.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":o._compress(t,6,(function(t){return n.charAt(t)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),o._decompress(t.length,32,(function(e){return i(n,t.charAt(e))})))},compress:function(e){return o._compress(e,16,(function(e){return t(e)}))},_compress:function(t,e,n){if(null==t)return"";var s,i,o,a={},r={},c="",l="",d="",h=2,u=3,p=2,m=[],v=0,f=0;for(o=0;o<t.length;o+=1)if(c=t.charAt(o),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=u++,r[c]=!0),l=d+c,Object.prototype.hasOwnProperty.call(a,l))d=l;else{if(Object.prototype.hasOwnProperty.call(r,d)){if(d.charCodeAt(0)<256){for(s=0;s<p;s++)v<<=1,f==e-1?(f=0,m.push(n(v)),v=0):f++;for(i=d.charCodeAt(0),s=0;s<8;s++)v=v<<1|1&i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i>>=1}else{for(i=1,s=0;s<p;s++)v=v<<1|i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i=0;for(i=d.charCodeAt(0),s=0;s<16;s++)v=v<<1|1&i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i>>=1}0==--h&&(h=Math.pow(2,p),p++),delete r[d]}else for(i=a[d],s=0;s<p;s++)v=v<<1|1&i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i>>=1;0==--h&&(h=Math.pow(2,p),p++),a[l]=u++,d=String(c)}if(""!==d){if(Object.prototype.hasOwnProperty.call(r,d)){if(d.charCodeAt(0)<256){for(s=0;s<p;s++)v<<=1,f==e-1?(f=0,m.push(n(v)),v=0):f++;for(i=d.charCodeAt(0),s=0;s<8;s++)v=v<<1|1&i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i>>=1}else{for(i=1,s=0;s<p;s++)v=v<<1|i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i=0;for(i=d.charCodeAt(0),s=0;s<16;s++)v=v<<1|1&i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i>>=1}0==--h&&(h=Math.pow(2,p),p++),delete r[d]}else for(i=a[d],s=0;s<p;s++)v=v<<1|1&i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i>>=1;0==--h&&(h=Math.pow(2,p),p++)}for(i=2,s=0;s<p;s++)v=v<<1|1&i,f==e-1?(f=0,m.push(n(v)),v=0):f++,i>>=1;for(;;){if(v<<=1,f==e-1){m.push(n(v));break}f++}return m.join("")},decompress:function(t){return null==t?"":""==t?null:o._decompress(t.length,32768,(function(e){return t.charCodeAt(e)}))},_decompress:function(e,n,s){var i,o,a,r,c,l,d,h=[],u=4,p=4,m=3,v="",f=[],w={val:s(0),position:n,index:1};for(i=0;i<3;i+=1)h[i]=i;for(a=0,c=Math.pow(2,2),l=1;l!=c;)r=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=s(w.index++)),a|=(r>0?1:0)*l,l<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)r=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=s(w.index++)),a|=(r>0?1:0)*l,l<<=1;d=t(a);break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)r=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=s(w.index++)),a|=(r>0?1:0)*l,l<<=1;d=t(a);break;case 2:return""}for(h[3]=d,o=d,f.push(d);;){if(w.index>e)return"";for(a=0,c=Math.pow(2,m),l=1;l!=c;)r=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=s(w.index++)),a|=(r>0?1:0)*l,l<<=1;switch(d=a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)r=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=s(w.index++)),a|=(r>0?1:0)*l,l<<=1;h[p++]=t(a),d=p-1,u--;break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)r=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=s(w.index++)),a|=(r>0?1:0)*l,l<<=1;h[p++]=t(a),d=p-1,u--;break;case 2:return f.join("")}if(0==u&&(u=Math.pow(2,m),m++),h[d])v=h[d];else{if(d!==p)return null;v=o+o.charAt(0)}f.push(v),h[p++]=o+v.charAt(0),o=v,0==--u&&(u=Math.pow(2,m),m++)}}};return o}();null!=t&&(t.exports=e)}(T={exports:{}},T.exports),T.exports);const S=JSON.stringify({numCreated:0,data:[]}),A=()=>JSON.parse(localStorage.getItem("tws-info")||S),N=t=>{localStorage.setItem("tws-info",JSON.stringify(t))},F=(t,e)=>{localStorage.setItem(t,E.compressToUTF16(e))},B=function(t){let{created:e=Date.now(),lastModified:n=Date.now(),name:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=A(),o=i.numCreated+1,a="tws-".concat(o);return F(a,t),i.numCreated=o,i.data.push({key:a,created:e,lastModified:n,name:s||"Writing #".concat(o)}),N(i),a},D=t=>{const e=A();for(let n=0,s=e.data.length;n<s;n+=1){const s=e.data[n];if(s.key===t)return[s,n]}return[null,-1]},_=t=>{const[e]=D(t);if(e)try{const t=localStorage.getItem(e.key)||"";return E.decompressFromUTF16(t)}catch(t){console.error(t)}return null},I=(t,e)=>{const[n,s]=D(t);if(n){n.name=e.name;const t=A();t.data[s]=n,N(t)}},O=t=>{const[,e]=D(t);if(e>-1){const t=A(),{key:n}=t.data[e];localStorage.removeItem(n),t.data.splice(e,1),N(t)}};let K=0;class P{constructor(t){let{submit:e="OK",cancel:n="Cancel"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{submit:"OK",cancel:"Cancel"};this.backdrop=x("div",{className:"backdrop dialog-backdrop"}),this.dialog=x("div",{className:"popup dialog"}),this.dialogForm=x("form",{onsubmit:t=>{t.preventDefault(),this.handleSubmit()}}),this.dialogFooter=x("div",{className:"dialog-footer"}),this.submitCallback=()=>{},this.cancelCallback=()=>{},this.closeCallback=()=>{},this.addFormElement=(t,e)=>{K+=1,e.setAttribute("id","dialog-input-".concat(K));const n=x("label",{htmlFor:e.id,innerHTML:t});return this.dialogForm.appendChild(n),this.dialogForm.appendChild(e),this},this.handleSubmit=()=>{!1!==this.submitCallback(this.formData)&&this.close()},this.onSubmit=t=>(this.submitCallback=t,this),this.onCancel=t=>(this.cancelCallback=t,this),this.onClose=t=>(this.closeCallback=t,this),this.dialog.setAttribute("role","dialog"),this.dialog.appendChild(x("header",{className:"dialog-header",innerHTML:t}));const s=x("div",{className:"dialog-body"});s.appendChild(this.dialogForm),this.dialog.appendChild(s),this.submitButton=x("button",{className:"button button-primary",type:"button",innerHTML:e,onclick:this.handleSubmit}),this.cancelButton=x("button",{className:"button",type:"button",innerHTML:n,onclick:()=>{this.cancelCallback(),this.close()}}),this.dialogFooter.appendChild(this.cancelButton),this.dialogFooter.appendChild(this.submitButton),this.dialog.appendChild(this.dialogFooter),this.backdrop.appendChild(this.dialog)}get formData(){const t=Array.from(this.dialogForm.elements),e={};for(const n of t)e[n.name]=n.value;return e}addInput(t,e){const n=x("input",e);return this.addFormElement(t,n)}addTextArea(t,e){const n=x("textarea",e);return this.addFormElement(t,n)}open(){document.body.appendChild(this.backdrop);const t=this.dialogForm.querySelector("input, textarea");null==t||t.focus(),null==t||t.select()}close(){var t,e;this.closeCallback(),null===(e=null===(t=this.backdrop)||void 0===t?void 0:t.parentNode)||void 0===e||e.removeChild(this.backdrop)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function U(t,e,n,s){return new(n||(n=Promise))((function(i,o){function a(t){try{c(s.next(t))}catch(t){o(t)}}function r(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((s=s.apply(t,e||[])).next())}))}const H=()=>{const t={data:A().data,writings:[]};if(0===t.data.length)return;for(const{key:e}of t.data){const n=_(e);n&&t.writings.push(n)}var e;((t,e)=>{const n=document.createElement("a");n.href=e,n.rel="download",n.download=t,n.click()})("tws.json",(e=t,"data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(e)))))},R=()=>U(void 0,void 0,void 0,(function*(){const t=yield new Promise((t,e)=>{const n=document.createElement("input");n.type="file",n.onchange=n=>{const s=n.target,{files:i}=s,o=i?i[0]:null;if(!o)return;const a=new FileReader;a.readAsText(o,"UTF-8"),a.onload=n=>{var s;const i=null===(s=null==n?void 0:n.target)||void 0===s?void 0:s.result;"string"==typeof i?t(i):e()},a.onerror=e},n.click()}),{writings:e,data:n}=JSON.parse(t);e.forEach((t,e)=>{B(t,n[e])})}));class W{constructor(t){this.backdrop=x("div",{className:"backdrop dialog-backdrop"}),this.dialog=x("div",{className:"popup dialog saved-list"}),this.dialogBody=x("div",{className:"dialog-body"}),this.dialogFooter=x("footer",{className:"dialog-footer"}),this.clickCallback=()=>{},this.editCallback=()=>{},this.deleteCallback=()=>{},this.closeCallback=()=>{},this.getSaved=()=>A().data.map(this.formatSaved),this.formatSaved=t=>{const{name:e,created:n}=t,s=x("li",{className:"saved-item",onclick:()=>{this.clickCallback(t),this.close()}}),i=x("span",{className:"saved-title-container"}),o=x("span",{className:"saved-title",innerHTML:e}),a=x("span",{className:"saved-date-created",innerHTML:(r=n,new Date(r).toLocaleString(void 0,{day:"numeric",month:"short",year:"numeric"})),title:new Date(n).toLocaleString()});var r;i.appendChild(o),i.appendChild(a);const c=x("button",{className:"edit-saved",innerHTML:"✏️",onclick:e=>{e.stopImmediatePropagation(),this.editCallback(t)}}),l=x("button",{className:"delete-saved",innerHTML:"🗑",onclick:e=>{e.stopImmediatePropagation(),this.deleteCallback(t)}});return s.appendChild(i),s.appendChild(c),s.appendChild(l),s},this.onClick=t=>(this.clickCallback=t,this),this.onEdit=t=>(this.editCallback=t,this),this.onDelete=t=>(this.deleteCallback=t,this),this.onClose=t=>(this.closeCallback=t,this),this.dialog.setAttribute("role","dialog"),this.dialog.appendChild(x("header",{className:"dialog-header",innerHTML:t})),this.backdrop.addEventListener("click",t=>{let{target:e}=t;e===this.backdrop&&this.close()}),this.exportButton=x("button",{className:"button",type:"button",innerHTML:"Export",onclick:H}),this.importButton=x("button",{className:"button",type:"button",innerHTML:"import",onclick:()=>U(this,void 0,void 0,(function*(){try{yield R()}catch(t){}finally{this.refreshList()}}))});const e=x("button",{className:"button",type:"button",innerHTML:"Close",onclick:this.close.bind(this)});this.refreshList(),this.dialogFooter.appendChild(this.exportButton),this.dialogFooter.appendChild(this.importButton),this.dialogFooter.appendChild(e),this.dialog.appendChild(this.dialogBody),this.dialog.appendChild(this.dialogFooter),this.backdrop.appendChild(this.dialog)}destroy(){var t;null===(t=this.backdrop.parentNode)||void 0===t||t.removeChild(this.backdrop)}open(){document.body.appendChild(this.backdrop)}close(){this.closeCallback(),this.destroy()}clearList(){var t;for(const e of Array.from(this.dialogBody.children))null===(t=e.parentNode)||void 0===t||t.removeChild(e)}refreshList(){const t=this.getSaved(),e=0===t.length;if(this.exportButton.disabled=e,this.clearList(),e){const t=x("div",{className:"empty-list",innerHTML:"Nothing saved"});this.dialogBody.appendChild(t)}else{const e=x("ul",{className:"saved-list"});for(const n of t)e.appendChild(n);this.dialogBody.appendChild(e)}}}const j=t=>{window.gtag("event",t,{event_category:"menu"})},J=o;class q{constructor(){var e=this;this.mousemovedelay=150,this.running=!1,this.typewriter=new b,this.menu=null,this.removeLongTouch=()=>{},this.events=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"on";const n={mousedown:e.handleMouseDown,touchstart:e.handleTouchStart,mouseup:e.handleMouseUp,touchend:e.handleMouseUp},i={keydown:e.handleKeyDown,keyup:e.handleKeyUp,focus:e.handleFocus,keypress:e.handleKeyPress},o="on"===t?"addEventListener":"removeEventListener";for(const t in n){const e=n[t];J[o](t,e)}for(const t in i){const e=i[t];s[o](t,e)}"on"===t?e.removeLongTouch=k(J,t=>{var n;const i=C(t);s.blur(),null===(n=e.menu)||void 0===n||n.openMenu(i)}):(e.removeLongTouch(),e.removeLongTouch=()=>{})},this.pressedKeys={},this.handleKeyDown=e=>{const n=e.altKey||e.ctrlKey||e.metaKey,i=t[e.which]||n;return!this.pressedKeys[e.code]&&(i?("TAB"===i&&(window.setTimeout(()=>{s.focus()},10),e.preventDefault()),!0):(this.pressedKeys[e.code]=!0,e.key,!0))},this.handleKeyPress=t=>{const e=t.altKey||t.ctrlKey||t.metaKey,n="Tab"===t.key||"Enter"===t.key;return(n||e)&&t.preventDefault(),!n},this.handleKeyUp=t=>{const{key:e,code:n}=t,i="Shift"===e,o=t.altKey||t.ctrlKey||t.metaKey;if(i)return;if(this.pressedKeys[n]&&delete this.pressedKeys[n],o)return void this.emptyText();const{typewriter:a}=this,r=a.cursor.navButtons[e],c=s.value.substr(1);r?r():c&&a.addCharacter(c),this.emptyText(),s.blur(),this.focusText()},this.handleFocus=()=>{this.focusText()},this.mouseDownStartPos=null,this.handleMouseDown=t=>{"button"in t&&2===t.button||(this.mouseuptimeout=window.setTimeout(()=>{this.mouseDownStartPos=C(t),J.addEventListener("touchmove",this.handleMouseMove),J.addEventListener("mousemove",this.handleMouseMove)},this.mousemovedelay))},this.handleTouchStart=t=>(t.preventDefault(),t.stopPropagation(),!(!t.touches||2!==t.touches.length)||this.handleMouseDown(t)),this.handleMouseMove=t=>{if(t.preventDefault(),t.stopPropagation(),!this.mouseDownStartPos)return;const e=C(t)._subtract(this.mouseDownStartPos);c(n,e),this.typewriter.cursor.clear()},this.handleMouseUp=t=>{const e="button"in t&&2===t.button,n="touches"in t&&t.touches.length>0;if(e||n)return;this.removeMoveEvent();const s=C(t);this.mouseDownStartPos?(s._subtract(this.mouseDownStartPos),this.typewriter.reposition(s),this.mouseDownStartPos=null):this.updateCursor(s)},this.updateCursor=t=>{this.typewriter.cursor.moveToClick(t),this.focusText()},this.removeMoveEvent=()=>{window.clearTimeout(this.mouseuptimeout),J.removeEventListener("touchmove",this.handleMouseMove),J.removeEventListener("mousemove",this.handleMouseMove)},this.emptyText=()=>{s.value="",s.value="="},this.focusText=()=>{s.focus()}}reset(){this.running=!0,this.typewriter.reset(),this.events("on"),this.emptyText(),this.focusText()}start(){this.running||(this.reset(),this.menu=(t=>{const e=new M;let n;return e.addMenuItem("New",{callback:()=>{n="",e.closeMenu(),t.reset(),j("menu:new")}}),e.addMenuItem("Save",{callback:()=>{const s=t.typewriter.export();if("[]"===s)return e.closeMenu(),void j("menu:save:empty");const i=n||B(s);let o="Save Writing",a="Delete";n&&(o="Update Writing",a="Discard Changes");const[r]=D(i);e.closeMenu(),new P("Save",{submit:o,cancel:a}).addInput("Name",{type:"text",name:"name",value:null==r?void 0:r.name}).onSubmit(t=>{let{name:e}=t;return!!e&&(n&&F(n,s),I(i,{name:e}),j("menu:save:success"),!0)}).onCancel(()=>{n||O(i),j("menu:save:cancel")}).open()}}),e.addMenuItem("View Saved",{callback:()=>{e.closeMenu(),j("menu:view-saved");const s=new W("Saved journals");s.onClick(e=>{let{key:s}=e;const i=_(s);i?(t.typewriter.import(i),n=s,j("menu:view-saved:view")):(O(s),j("menu:view-saved:delete-empty"))}).onDelete(t=>{let{key:e}=t;O(e),s.refreshList(),j("menu:view-saved:delete")}).onEdit(t=>{let{name:e,key:n}=t;new P("Update",{submit:"Update Writing"}).addInput("Name",{type:"text",name:"name",value:e}).onSubmit(t=>{let{name:e}=t;return!!e&&(I(n,{name:e}),s.refreshList(),j("menu:view-saved:edit"),!0)}).open()}).onClose(()=>{t.focusText(),t.typewriter.cursor.draw()}).open()}}),e})(this))}stop(){var t;this.running&&(this.running=!1,this.events("off"),this.removeMoveEvent(),null===(t=this.menu)||void 0===t||t.destroy(),this.menu=null)}}const{search:G}=window.location,X=G?G.substr(1).split("&").reduce((t,e)=>{const[n,s]=e.split("=");return t[n]=s,t},{}):{};(t=>{const e=document.createElement("script"),n=document.getElementsByTagName("script")[0];e.async=!0,e.src=t,n.parentNode.insertBefore(e,n)})("https://www.googletagmanager.com/gtag/js?id=UA-73887811-5"),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config","UA-73887811-5");const Y=document.getElementById("splash"),z=t=>{if(t.altKey||t.ctrlKey||t.metaKey)return;Y.classList.add("hide"),Y.removeEventListener("click",z),Y.removeEventListener("keyup",z);const e=new q;e.start(),e.focusText()},V=()=>{window.location.hash&&(window.location.hash=""),Y.focus(),Y.addEventListener("click",z),Y.addEventListener("keyup",z),window.removeEventListener("load",V)};window.addEventListener("load",V),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(t=>{t.installing?console.log("Service worker installing"):t.waiting?console.log("Service worker installed"):t.active&&console.log("Service worker active")}).catch(t=>{console.error("Service Worker failed"),console.error(t)}),"debug"in X&&document.body.classList.add("debug");
